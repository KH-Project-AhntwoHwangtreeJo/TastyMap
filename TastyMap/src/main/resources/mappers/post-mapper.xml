<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="postMapper">
	
	<!-- Post 상세페이지 모든 사진 조회용 -->
   <resultMap id="postDetailPicture" type="map">
      <result property="pRenamedName" column="PRENAMEDNAME"/>
   </resultMap>
   
	<select id="selectRestaurantName" parameterType="String" resultType="Restaurant">
		SELECT * FROM RESTAURANT WHERE RNAME = #{rName}
	</select>
	
	<insert id="insertFirstRestaurant" parameterType="Map"> 
       INSERT INTO RESTAURANT(RNO, RNAME, ADDRESS) 
       VALUES(SEQ_RES.NEXTVAL, #{rNameParam}, #{addressParam})
	</insert>
	
	<insert id="insertPost" parameterType="Post"> 
       INSERT INTO POST(PNO, RNO, MEMBER_ID, PCONTENT, STAR) 
       VALUES(SEQ_POST.NEXTVAL, #{rNo}, #{member_Id}, #{pContent}, #{star})
	</insert>
 
 
 	<select id="selectCurrval" resultType="_int">
 		SELECT SEQ_POST.CURRVAL FROM DUAL
 	</select>
 
	<insert id="insertPicture">
<!-- 		<selectKey keyProperty="pNo_CURRVAL" resultType="_int" order="BEFORE">
			SELECT SEQ_PNO.CURRVAL FROM DUAL
		</selectKey> 
-->
			INSERT INTO PICTURE(PICTURE_NO, PNO, PORIGINNAME, PRENAMEDNAME, PLEVEL, UPLOADDATE)
			VALUES(SEQ_PICTURE.NEXTVAL, #{pNo}, #{pOriginName}, #{pRenamedName}, #{pLevel}, SYSDATE)
	</insert>
	
	<!-- ●POST 디테일 조회용  -->
	<select id="postDetail" parameterType="_int" resultType="Post">
		SELECT P.*, M.NICKNAME, R.ADDRESS, R.RNAME
		FROM POST P
		JOIN MEMBER M ON(M.MEMBER_ID=P.MEMBER_ID)
		JOIN RESTAURANT R ON(R.RNO = P.RNO)
		WHERE P.PNO=#{pNo} AND P.PSTATUS = 'Y'
	</select>
	
	<!-- ●POST 디테일 사진 조회용  -->
	<select id="postDetailPicture" parameterType="_int" resultMap="postDetailPicture">
		SELECT PRENAMEDNAME 
		FROM PICTURE
		WHERE PNO = #{pNo}
	</select>
</mapper>










