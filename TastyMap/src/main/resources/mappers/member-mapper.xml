<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberMapper">
	<resultMap type="Member" id="memberMap">
		<result property="hobby" column="hobby" typeHandler="Str2ArrayHandler"/>
	</resultMap>
	
	<insert id="insertMember" parameterType="Member">
		INSERT INTO MEMBER VALUES (#{memberId}, #{password} , #{userName}, #{nickname}, #{mcontent}, #{birth}, 
		#{gender}, #{phone}, #{email}, #{address}, DEFAULT , #{mphoto})
	</insert>
	
	<select id="checkIdDuplicate" parameterType="HashMap" statementType="CALLABLE">
		{ CALL ID_DUP_CHECK(
                       #{userId, mode=IN, jdbcType=VARCHAR}, 
                     #{result, mode=OUT, jdbcType=NUMERIC, javaType=integer} ) 
       }
	</select>
	
	<!-- ●마이 갤러리페이지 조회용  -->
	<select id="myGallery" parameterType="string" resultMap="memberMap">
		SELECT NICKNAME, MCONTENT, MPHOTO, 
		               (SELECT PICTURENAME FROM PICTURE  JOIN POST USING(PNO)
		                   WHERE MEMBER_ID = #{memberId} AND PSTATUS = 'Y' AND PLEVEL =0
		                   ORDER BY PDATE DESC) PIC
		FROM MEMBER 
		JOIN POST USING(MEMBER_ID)
		WHERE MEMBER_ID = #{memberId}
	</select>
	
 	<!-- ●팔로잉 팔로워 게시글 개수 출력 -->
<!-- 	<select id="followAndPostCnt" parameterType="hashmap" resultMap="followAndPostCnt">
	       SELECT (SELECT COUNT(*) FROM FOLLOWER WHERE MEMBER_ID = #{memberId}) FOLLOWER_CNT, 팔로워 :나를 팔로우 클릭한 사람(member_id가 내 아이디일때)
	             (SELECT COUNT(*) FROM FOLLOWER WHERE FOLLOWER_ID = #{memberId}) FOLLOWING_CNT,팔로잉 :내가 팔로우 클릭한 사람(follower_id가 내 아이디일때)
	             (SELECT COUNT(*) FROM POST WHERE MEMEBER_ID = #{memberId} AND PSTATUS = 'Y') MY_POST_CNT 
	      FROM DUAL
	</select> -->
</mapper>










